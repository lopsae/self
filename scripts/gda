#!/bin/bash

# Finds with gick a file from the modified files with a workspace status.
# With it, runs the giff command, followed with the gadd command for the
# same file.

# If run without any parameters it will pick the first available unstaged
# file.


# Checking for no options case
if [[ $# = '0' ]]; then
	fileFound=$(gick -w -d "." 2> /dev/null)
else
	fileFound=$(gick -w "$@" 2> /dev/null)
fi

if [[ $? != 0 ]]; then
	echo 'No file found' >&2
	exit 1
fi

echo "filename: $fileFound"
echo 'Waiting for diff tool to return...'

# With the -n option giff will just use the parameter as filename
# instead of searching it with gick again
giff -n "$fileFound"

read -p 'Git add? (y) ' addConfirm

if [ "$addConfirm" = 'y' ]; then
	echo $fileFound | gadd
	echo
	git status --short --branch
else
	echo 'Aborted' >&2
	exit 1
fi

